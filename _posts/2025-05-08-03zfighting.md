---
title: "25.05.08 / Z-Fighting"
excerpt: ""

categories:
  - Programming
  - Game Development
tags:
  - []

toc: true
toc_sticky: true

date: 2025-05-08
last_modified_at: 2025-05-12
---

<div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
  <img src="/assets/img/250508_03zfighting/01.png" alt="01" style="max-width: 100%;" />
</div>

**Z-Fighting**이란 3D 그래픽스에서 **두 개(혹은 그 이상)의 표면(폴리곤)이 거의 동일한 공간(Z-Depth)에 위치**하여, 어느 쪽이 화면에 먼저 그려질지가 GPU의 Z 버퍼(Z-Buffer) 연산에서 미묘한 오차로 인해 깜빡이거나 섞여 보이는 현상을 말한다. 즉, 아주 가까운 두 표면이 렌더링될 때, 깊이 값(Depth)이 충돌을 일으켜 화면 출력이 불안정해지는 문제이다.

---

### **1\. 왜 발생할까?**

#### **1) 부동소수점 정밀도 한계**
- 렌더링 파이프라인에서 객체의 위치∙카메라 변환∙투영 변환을 거쳐 최종 스크린 좌표로 변환되는 과정에서 **부동소수점(Floating-point) 정밀도의 오차**가 발생한다.
- 두 폴리곤이 거의 동일한 Z 값(깊이)을 가지면, 소수점 자리 이하의 미세한 차이로 인해 어떤 프레임에서는 A 폴리곤이 앞에, 다음 프레임에서는 B 폴리곤이 앞에 그려지는 식으로 **깜빡임**이 생길 수 있다.

#### **2) 깊이 버퍼(Depth buffer)의 해상도**
- 깊이 버퍼는 보통 16비트, 24비트, 32비트 등의 정밀도를 갖는다.
- 카메라 클리핑 범위(Near ~ Far)가 너무 넓거나, 화면상에서 Z 차이가 극도로 작은 표면의 겹치면 Depth 버퍼가 구분하기 어려운 값이 된다.

#### **3) 의도적으로 겹친 표면**
- 일부 게임 오브젝트(예: 지형과 데칼, 타일 등)를 의도적으로 거의 같은 높이로 설정했을 때, Z-Fighting이 발생할 수 있다.

---

### **2\. 어떤 상황에서 잘 발생하나?**

1. **동일한 지오메트리(Polygon)가 중첩된 경우**
  - 예: 완전히 동일한 두 면이 같은 위치에 배치되었을 대, 렌더 순서에 따라 어느 쪽이 먼저 그려질지 불안정하게 바뀐다.
2. **LOD 또는 타일링이 겹칠 때**
  - 지형 시스템에서 여러 타일이 경계 부분에서 미세하게 겹치는 경우, 카메라 거리에 따라 깜빡임을 일으킬 수 있다.
3. **스카이박스나 GUI 요소**
  - 3D 공간의 가장 먼 거리에 있는 스카이박스와 가까운 곳에 있는 GUI(또는 2D 패널)이 깊이 값을 공유할 때, 매우 드물게 Z-Fighting이 일어날 수도 있다.

---

### **3\. 어떻게 해결할까?**

1. **깊이 오프셋(Polygon Offset) 사용**
  - 그래픽스 API나 셰이더에서 "Polygon Offset" 기능을 사용해, 겹칠 가능성이 있는 표면에 약간의 깊이 오프셋을 준다.
  - 예: 지형 위에 있는 데칼이나 표식은 소량의 오프셋을 줘서 지형과 겹치지 않도록 한다.

2. **Z-Test & Render Queue 조정**
  - 렌더링 순서를 제어하여 먼저 그려야 할 것을 확실히 먼저 그리고, 이후에 겹칠 여지가 있는 것에 대해서는 Z-테스트를 적절히 설정한다.
  - 예: 데칼 전용 셰이더 또는 투명 오브젝트를 별도의 Render Queue에서 처리한다.

3. **근평면(Near Clip), 원평면(Far Clip)을 적절히 설정**
  - 카메라의 클리핑 범위가 불필요하게 넓으면 Depth 버퍼 정밀도가 낮아진다.
  - 게임 상황에 맞춰 Near~Far 범위를 조절해 정밀도를 높이면 Z-Fighting이 줄어든다.

4. **지오메트리 재설계**
  - 서로 겹치는 면이 최대한 생기지 않도록 모델링 단계에서 신경 쓴다.
  - 타일 경계나 LOD가 바뀌는 지점이 살짝 높이 차이를 가지도록 조정할 수 있다.

5. **카메라 FOV, Z-Buffer 비트 수 확인**
  - 엔진 설정에서 Depth 또는 Stencil 버퍼의 비트 수(24/32 등)와 카메라 FOV 등이 적절한지 확인한다.

6. **셰이더에서 Clip Space 조정**
  - 경우에 따라 셰이더 코드에서 클립 스페이스 Z 값을 약간 조정하여 Z-Fighting을 완화하기도 한다.
  