---
title: "25.05.09 / 지형(Terrain)을 구현할 때 쿼드트리를 쓰는 이유"
excerpt: ""

categories:
  - Programming
  - Game Development
tags:
  - []

toc: true
toc_sticky: true

date: 2025-05-09
last_modified_at: 2025-05-12
---

<div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
  <img src="/assets/img/250509_01terrain/01.png" alt="01" style="max-width: 100%;" />
</div>

### **1\. 쿼드트리(QuadTree)란?**

- 2D 평면을 **4분할**(Quadrant)하는 방식으로 재귀적으로 분할해나가는 트리 구조이다.
- 루트 노드를 하나의 큰 사각형(지형 전체)으로 놓고, 이를 4개의 하위 사각형(Quadrant)으로 나눈 뒤, 필요하다면 각 하위 사각형을 다시 4개로 분할하는 과정을 반복한다.

> 참고
  - 2D 영역 분할에 사용: "쿼드트리(QuadTree)"
  - 3D 영역 분할에 사용: "옥트리(Octree), 8분할"

---

### **2\. 왜 지형 구현에 쿼드트리를 쓰는가?**

**1) LOD 처리**
- 지형은 보통 **넓은 범위**에 걸쳐 있으며, 플레이어가 가까이 보는 영역과 멀리 보는 영역의 **디테일 정도**가 달라야 성능을 확보할 수 있다.
- 쿼드트리를 사용하면, **멀리 있는 지형**은 큰 사각형 단위로 단순화(낮은 폴리곤 LOD), **가까운 지형**은 더 잘게 분할되어 높은 디테일(높은 폴리곤 수)을 가지도록 구조화하기가 쉽다.

**2) 공간 분할 및 효율적 렌더링**
- 대규모 지형을 한 번에 모두 렌더링하면, 볼 필요가 없는 영역(현재 카메라에 보이지 않는 영역)까지 연산해야 하므로 매우 비효율적이다.
- 쿼드트리를 통해 지형을 잘게 나누어두면, 카메라 뷰 안에 있는 노드들만 선택적으로 렌더링할 수 있다(프러스텀 컬링).
- 즉, 트리 구조를 따라가면서 화면과 교차하는 노드만 처리하므로, 불필요한 연산이 줄어든다.

**3) 충돌 처리 / 지형 검사 용이**
- 지형 위에서 레이캐스트나 충돌 처리를 할 때에도, 쿼드트리르 통해 지형을 빠르게 탐색하고 정확한 서브 섹션만 검사할 수 있다.
- 예: 플레이어가 현재 어느 사각형(노드) 범위 안에 있는지를 빠르게 판단하고, 그 노드에 해당하는 지형(삼각형 메쉬)만 충돌 검사를 진행.

**4) 메모리 관리**
- 지형 데이터를 모두 한 번에 메모리에 올리는 대신, **필요한 구역(쿼드트리 노드)만 로드**하는 스트리밍(Streaming)을 사용할 수 있다.
- 플레이어가 접근하는 구역을 중심으로만 높은 해상도(LOD)를 유지하고, 멀리 떨어진 구역은 메모리에서 언로드하거나 저해상도 데이터만 유지한다.

**5) 확장성 & 유지보수**
- 지형이 추가적으로 확정되거나 일부 영역만 수정하더라도, 쿼드트리 구조 안에서 해당 노드(사각형) 부분만 다시 빌드하거나 로딩할 수 있어 재활용성과 확장성이 좋다.

---

### **3\. 일반적인 구현 흐름**

1. **지형 데이터(Heightmap) 로드**
- 예: 높이 정보를 저장한 이미지(Heightmap)이나 노이즈 기반 알고리즘(Perlin Noise 등)을 이용해 지형 생성

2. **쿼드트리 생성**
- 루트 노드 = 지형 전체 범위
- 일정 기준(예: 폴리곤 수, 지형 디테일 요구치)에 따라 4개 자식 노드로 분할, 필요하면 재귀적으로 다시 분할

3. **LOD 설정**
- 노드별로 지형 디테일 수준을 달리함(근접 노드 = 높은 폴리곤, 원거리 노드 = 낮은 폴리곤)
- 노드 경계부(Seam) 처리를 위해 "Geomorphing" 또는 "Stitching" 기법을 사용할 수 있음

4. **프러스텀 컬링**
- 카메라 뷰 프러스텀과 노드의 바운딩 박스를 체크
- 교차하는 노드만 렌더링 리스트에 포함

5. **실시간 업데이트 (Streaming / LOD 동적 변경)**
- 플레이어 이동/카메라 이동에 따라, 적절한 노드를 활성화/비활성화 또는 LOD 레벨 교체

---

### **4\. 요약**

- **쿼드트리**는 2D 평면을 재귀적으로 4분할해 관리하는 자료 구조로, **넓은 지형을 효율적으로 나타내기**에 매우 적합하다.
- 이를 통해 **LOD 제어, 프러스텀 컬링, 충돌 검출, 메모리 관리 등**을 간소화하고 최적화할 수 있다.
- 따라서 많은 게임 엔진(또는 자체 지형 시스템)에서 "쿼드트리" 기반으로 지형을 구성해, 멀리 있는 지형은 단순화하고 가까운 지형은 세밀하게 그리는 방식을 사용한다.

